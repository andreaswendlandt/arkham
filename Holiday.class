<?php
/* Klasse: Catalog
 * Zweck: Klasse, die die Produktdaten enthaelt
 */
class Catalog
{
	private $cxn;
	private $catalog_name;
	private $host;
	private $user;
	private $password;
	function __construct($filename)
	{
		if(is_string($filename))
		{
			include("$filename");
		}
		else
		{
			throw new Exception("Parameter ist kein Dateiname");
		}
		$this->cxn = new mysqli($host,$user,$password);
		if(mysqli_connect_errno())
		{
			throw new Exception("Datenbank nicht verf&uuml;gbar, versuchen Sie es sp&auml;ter erneut");
			exit();
		}
		$this->host = $host;
		$this->user = $user;
		$this->password = $password;
	}
	function selectCatalog($database)
	{
		$db = $this->cxn->select_db($database);
		if(mysqli_errno($this->cxn))
		{
			if(mysqli_errno($this->cxn) == 1049)
			{
				throw new Exception("$database existiert nicht.");
				exit();
			}
			else
			{
				throw new Exception("Datenbank nicht verf&uuml;gbar, versuchen Sie es sp&auml;ter erneut");
				exit();
			}
		}
		$this->catalog_name = $database;
	}
	function getCategoriesAndTypes()
	{
		$sql = "SELECT DISTINCT kontinent,land FROM urlaubsziele ORDER BY kontinent,land";
		if(!$result = $this->cxn->query($sql))
		{
			throw new Exception(mysqli_error($this->cxn));
			exit();
		}
		while($row=$result->fetch_array())
		{
			$array_cat_type[$row['kontinent']][]=$row['land'];
		}
		return $array_cat_type;
	}
	function getAllofType($type)
	{
		if(is_string($type))
		{
			$sql = "SELECT * FROM urlaubsziele WHERE land='$type' ORDER BY hotel";
		}
		else
		{
			throw new Exception("$type ist kein Typ.");
			exit();
		}
		if(!$result = $this->cxn->query($sql))
		{
			throw new Exception(mysqli_error($this->cxn));
			exit();
		}
		$n=1;
		while($row=$result->fetch_object())
		{
			$array_all[$n] = $row;
			$n++;
		}
		return $array_all;
	}
	function displayCategories()
	{
		$continent = $this->getCategoriesAndTypes();
		include("first_site.inc");
	}
	function displayAllofType($type,$site)
	{
		if(is_string($type))
		{	
			$all = $this->getAllofType($type);
		}
		else
		{
			throw new Exception("$type ist kein Typ.");
			exit();
		}
		if(is_int($site))
		{
			$n_per_page = $site;
		}
		else
		{
			throw new Exception("$site ist nicht Integer.");
			exit();
		}
		$n_products = sizeof($all);
		if(isset($_POST['n_end']))
		{
			if($_POST['Products'] == "Vorherige")
			{
				$n_start = $_POST['n_end']-($n_per_page);
			}
			else
			{
				$n_start = $_POST['n_end'] + 1;
			}
		}
	else
	{
		$n_start = 1;
	}
	$n_end = $n_start + $n_per_page -1;
	if($n_end >= $n_products)
	{
		$n_end = $n_products;
	}
	include("second_site.inc");
	}
}
?>

		
