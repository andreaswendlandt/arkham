<?php
/* Klasse: Holiday
 * Zweck: Klasse, die sämtliche benötigten Daten generiert
 */
class Holiday
{
	private $conn;
	private $db_name;
	private $host;
	private $user;
	private $password;
	function __construct($filename)
	{
		if(is_string($filename))
		{
			include("$filename");
		}
		else
		{
			throw new Exception("Parameter ist kein Dateiname");
		}
		$this->conn = new mysqli($host,$user,$password);
		if(mysqli_connect_errno())
		{
			throw new Exception("Datenbank nicht verf&uuml;gbar, versuchen Sie es sp&auml;ter erneut");
			exit();
		}
		$this->host = $host;
		$this->user = $user;
		$this->password = $password;
	}
	function selectCatalog($database)
	{
		$db = $this->conn->select_db($database);
		if(mysqli_errno($this->conn))
		{
			if(mysqli_errno($this->conn) == 1049)
			{
				throw new Exception("$database existiert nicht.");
				exit();
			}
			else
			{
				throw new Exception("Datenbank nicht verf&uuml;gbar, versuchen Sie es sp&auml;ter erneut");
				exit();
			}
		}
		$this->db_name = $database;
	}
	function getCategoriesAndTypes()
	{
		$sql = "SELECT DISTINCT kontinent FROM urlaubsziele ORDER BY kontinent,land";
		if(!$result = $this->conn->query($sql))
		{
			throw new Exception(mysqli_error($this->conn));
			exit();
		}
		while($row=$result->fetch_array())
		{
			$array_cat_type[$row['kontinent']][]=$row['land'];
		}
		return $array_cat_type;
	}
	function getAllofType($type)
	{
		if(is_string($type))
		{
			$sql = "SELECT * FROM urlaubsziele WHERE kontinent='$type' ORDER BY hotel";
		}
		else
		{
			throw new Exception("$type ist kein Typ.");
			exit();
		}
		if(!$result = $this->conn->query($sql))
		{
			throw new Exception(mysqli_error($this->conn));
			exit();
		}
		$n=1;
		while($row=$result->fetch_object())
		{
			$array_all[$n] = $row;
			$n++;
		}
		return $array_all;
	}
	function displayCategories()
	{
		$continent = $this->getCategoriesAndTypes();
		include("first_site.inc");
	}
	function displayAllofType($type)
	{
		if(is_string($type))
		{	
			$all = $this->getAllofType($type);
		}
		else
		{
			throw new Exception("$type ist kein Typ.");
			exit();
		}
		$n_destination = sizeof($all);
			$n_start = 1;
			$n_end = $n_destination;
		include("second_site.inc");
	}
}
?>

		
